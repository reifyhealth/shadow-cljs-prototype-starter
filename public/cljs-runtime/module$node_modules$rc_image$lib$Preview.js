shadow$provide.module$node_modules$rc_image$lib$Preview=function(global,require,module,exports){global=require("module$node_modules$$babel$runtime$helpers$interopRequireWildcard");module=require("module$node_modules$$babel$runtime$helpers$interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:!0});exports.default=void 0;var _extends2=module(require("module$node_modules$$babel$runtime$helpers$extends")),_objectSpread2=module(require("module$node_modules$$babel$runtime$helpers$objectSpread2")),
_defineProperty2=module(require("module$node_modules$$babel$runtime$helpers$defineProperty")),_slicedToArray2=module(require("module$node_modules$$babel$runtime$helpers$slicedToArray")),_objectWithoutProperties2=module(require("module$node_modules$$babel$runtime$helpers$objectWithoutProperties")),React=global(require("module$node_modules$react$index")),_rcDialog=module(require("module$node_modules$rc_dialog$lib$index")),_classnames5=module(require("module$node_modules$classnames$index")),_addEventListener=
module(require("module$node_modules$rc_util$lib$Dom$addEventListener")),_warning=require("module$node_modules$rc_util$lib$warning"),_useFrameSetState3=module(require("module$node_modules$rc_image$lib$hooks$useFrameSetState")),_getFixScaleEleTransPosition=module(require("module$node_modules$rc_image$lib$getFixScaleEleTransPosition")),_PreviewGroup=require("module$node_modules$rc_image$lib$PreviewGroup"),useState=React.useState,useEffect=React.useEffect,initialPosition={x:0,y:0};exports.default=function(props){var prefixCls=
props.prefixCls,src=props.src,alt=props.alt,onClose=props.onClose,visible=props.visible,_props$icons=props.icons,icons=void 0===_props$icons?{}:_props$icons;props=(0,_objectWithoutProperties2.default)(props,"prefixCls src alt onClose afterClose visible icons".split(" "));var rotateLeft=icons.rotateLeft,rotateRight=icons.rotateRight,zoomIn=icons.zoomIn,zoomOut=icons.zoomOut,close=icons.close;_props$icons=icons.left;icons=icons.right;var _useState=useState(1);_useState=(0,_slicedToArray2.default)(_useState,
2);var scale=_useState[0],setScale=_useState[1];_useState=useState(0);_useState=(0,_slicedToArray2.default)(_useState,2);var rotate=_useState[0],setRotate=_useState[1];_useState=(0,_useFrameSetState3.default)(initialPosition);_useState=(0,_slicedToArray2.default)(_useState,2);var position=_useState[0],setPosition=_useState[1],imgRef=React.useRef(),originPositionRef=React.useRef({originX:0,originY:0,deltaX:0,deltaY:0});_useState=React.useState(!1);_useState=(0,_slicedToArray2.default)(_useState,2);
var isMoving=_useState[0],setMoving=_useState[1],_React$useContext=React.useContext(_PreviewGroup.context),previewUrls=_React$useContext.previewUrls,current=_React$useContext.current;_useState=_React$useContext.isPreviewGroup;var setCurrent=_React$useContext.setCurrent,previewGroupCount=previewUrls.size,previewUrlsKeys=Array.from(previewUrls.keys()),currentPreviewIndex=previewUrlsKeys.indexOf(current);src=_useState?previewUrls.get(current):src;_useState=_useState&&1<previewGroupCount;_React$useContext=
React.useState({wheelDirection:0});_React$useContext=(0,_slicedToArray2.default)(_React$useContext,2);var lastWheelZoomDirection=_React$useContext[0],setLastWheelZoomDirection=_React$useContext[1],onZoomIn=function(){setScale(function(value){return value+1});setPosition(initialPosition)},onZoomOut=function(){1<scale&&setScale(function(value){return value-1});setPosition(initialPosition)};_React$useContext=function(event){event.preventDefault();event.stopPropagation();0<currentPreviewIndex&&setCurrent(previewUrlsKeys[currentPreviewIndex-
1])};previewUrls=function(event){event.preventDefault();event.stopPropagation();currentPreviewIndex<previewGroupCount-1&&setCurrent(previewUrlsKeys[currentPreviewIndex+1])};current=(0,_classnames5.default)((0,_defineProperty2.default)({},"".concat(prefixCls,"-moving"),isMoving));var toolClassName="".concat(prefixCls,"-operations-operation"),iconClassName="".concat(prefixCls,"-operations-icon");rotateLeft=[{icon:close,onClick:onClose,type:"close"},{icon:zoomIn,onClick:onZoomIn,type:"zoomIn"},{icon:zoomOut,
onClick:onZoomOut,type:"zoomOut",disabled:1===scale},{icon:rotateRight,onClick:function(){setRotate(function(value){return value+90})},type:"rotateRight"},{icon:rotateLeft,onClick:function(){setRotate(function(value){return value-90})},type:"rotateLeft"}];var onMouseUp=function(){if(visible&&isMoving){var width=imgRef.current.offsetWidth*scale,height=imgRef.current.offsetHeight*scale,_imgRef$current$getBo=imgRef.current.getBoundingClientRect(),_left=_imgRef$current$getBo.left;_imgRef$current$getBo=
_imgRef$current$getBo.top;var isRotate=0!==rotate%180;setMoving(!1);(width=(0,_getFixScaleEleTransPosition.default)(isRotate?height:width,isRotate?width:height,_left,_imgRef$current$getBo))&&setPosition((0,_objectSpread2.default)({},width))}},onMouseMove=function(event){visible&&isMoving&&setPosition({x:event.pageX-originPositionRef.current.deltaX,y:event.pageY-originPositionRef.current.deltaY})},onWheelMove=function(event){visible&&(event.preventDefault(),setLastWheelZoomDirection({wheelDirection:event.deltaY}))};
useEffect(function(){var wheelDirection=lastWheelZoomDirection.wheelDirection;0<wheelDirection?onZoomOut():0>wheelDirection&&onZoomIn()},[lastWheelZoomDirection]);useEffect(function(){var onMouseUpListener=(0,_addEventListener.default)(window,"mouseup",onMouseUp,!1),onMouseMoveListener=(0,_addEventListener.default)(window,"mousemove",onMouseMove,!1),onScrollWheelListener=(0,_addEventListener.default)(window,"wheel",onWheelMove,{passive:!1});try{if(window.top!==window.self){var onTopMouseUpListener=
(0,_addEventListener.default)(window.top,"mouseup",onMouseUp,!1);var onTopMouseMoveListener=(0,_addEventListener.default)(window.top,"mousemove",onMouseMove,!1)}}catch(error){(0,_warning.warning)(!1,"[rc-image] ".concat(error))}return function(){onMouseUpListener.remove();onMouseMoveListener.remove();onScrollWheelListener.remove();onTopMouseUpListener&&onTopMouseUpListener.remove();onTopMouseMoveListener&&onTopMouseMoveListener.remove()}},[visible,isMoving]);return React.createElement(_rcDialog.default,
(0,_extends2.default)({transitionName:"zoom",maskTransitionName:"fade",closable:!1,keyboard:!0,prefixCls:prefixCls,onClose:onClose,afterClose:function(){setScale(1);setRotate(0);setPosition(initialPosition)},visible:visible,wrapClassName:current},props),React.createElement("ul",{className:"".concat(prefixCls,"-operations")},rotateLeft.map(function(_ref){var icon=_ref.icon,onClick=_ref.onClick,type=_ref.type;_ref=_ref.disabled;return React.createElement("li",{className:(0,_classnames5.default)(toolClassName,
(0,_defineProperty2.default)({},"".concat(prefixCls,"-operations-operation-disabled"),!!_ref)),onClick:onClick,key:type},React.isValidElement(icon)?React.cloneElement(icon,{className:iconClassName}):icon)})),React.createElement("div",{className:"".concat(prefixCls,"-img-wrapper"),style:{transform:"translate3d(".concat(position.x,"px, ").concat(position.y,"px, 0)")}},React.createElement("img",{onMouseDown:function(event){0===event.button&&(event.preventDefault(),event.stopPropagation(),originPositionRef.current.deltaX=
event.pageX-position.x,originPositionRef.current.deltaY=event.pageY-position.y,originPositionRef.current.originX=position.x,originPositionRef.current.originY=position.y,setMoving(!0))},ref:imgRef,className:"".concat(prefixCls,"-img"),src:src,alt:alt,style:{transform:"scale3d(".concat(scale,", ").concat(scale,", 1) rotate(").concat(rotate,"deg)")}})),_useState&&React.createElement("div",{className:(0,_classnames5.default)("".concat(prefixCls,"-switch-left"),(0,_defineProperty2.default)({},"".concat(prefixCls,
"-switch-left-disabled"),0===currentPreviewIndex)),onClick:_React$useContext},_props$icons),_useState&&React.createElement("div",{className:(0,_classnames5.default)("".concat(prefixCls,"-switch-right"),(0,_defineProperty2.default)({},"".concat(prefixCls,"-switch-right-disabled"),currentPreviewIndex===previewGroupCount-1)),onClick:previewUrls},icons))}}
//# sourceMappingURL=module$node_modules$rc_image$lib$Preview.js.map
