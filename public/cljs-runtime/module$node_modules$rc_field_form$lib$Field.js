shadow$provide.module$node_modules$rc_field_form$lib$Field=function(global,require,module,exports){function requireUpdate(shouldUpdate,prev,next,prevValue,nextValue,info){return"function"===typeof shouldUpdate?shouldUpdate(prev,next,"source"in info?{source:info.source}:{}):prevValue!==nextValue}global=require("module$node_modules$$babel$runtime$helpers$interopRequireWildcard");module=require("module$node_modules$$babel$runtime$helpers$interopRequireDefault");Object.defineProperty(exports,"__esModule",
{value:!0});exports.default=void 0;var _extends2=module(require("module$node_modules$$babel$runtime$helpers$extends")),_objectWithoutProperties2=module(require("module$node_modules$$babel$runtime$helpers$objectWithoutProperties")),_defineProperty2=module(require("module$node_modules$$babel$runtime$helpers$defineProperty")),_objectSpread2=module(require("module$node_modules$$babel$runtime$helpers$objectSpread2")),_toConsumableArray2=module(require("module$node_modules$$babel$runtime$helpers$toConsumableArray")),
_classCallCheck2=module(require("module$node_modules$$babel$runtime$helpers$classCallCheck")),_createClass2=module(require("module$node_modules$$babel$runtime$helpers$createClass")),_assertThisInitialized2=module(require("module$node_modules$$babel$runtime$helpers$assertThisInitialized")),_inherits2=module(require("module$node_modules$$babel$runtime$helpers$inherits")),_createSuper2=module(require("module$node_modules$$babel$runtime$helpers$createSuper")),_toArray=module(require("module$node_modules$rc_util$lib$Children$toArray")),
_warning=module(require("module$node_modules$rc_util$lib$warning")),React=global(require("module$node_modules$react$index")),_FieldContext=global(require("module$node_modules$rc_field_form$lib$FieldContext")),_typeUtil=require("module$node_modules$rc_field_form$lib$utils$typeUtil"),_validateUtil=require("module$node_modules$rc_field_form$lib$utils$validateUtil"),_valueUtil=require("module$node_modules$rc_field_form$lib$utils$valueUtil"),Field=function(_React$Component){function Field(props){(0,_classCallCheck2.default)(this,
Field);var _this=_super.call(this,props);_this.state={resetCount:0};_this.cancelRegisterFunc=null;_this.mounted=!1;_this.touched=!1;_this.dirty=!1;_this.validatePromise=null;_this.errors=[];_this.cancelRegister=function(){var _this$props=_this.props,preserve=_this$props.preserve,isListField=_this$props.isListField;_this$props=_this$props.name;_this.cancelRegisterFunc&&_this.cancelRegisterFunc(isListField,preserve,(0,_valueUtil.getNamePath)(_this$props));_this.cancelRegisterFunc=null};_this.getNamePath=
function(){var _this$props2=_this.props,name=_this$props2.name;_this$props2=_this$props2.fieldContext.prefixName;_this$props2=void 0===_this$props2?[]:_this$props2;return void 0!==name?[].concat((0,_toConsumableArray2.default)(_this$props2),(0,_toConsumableArray2.default)(name)):[]};_this.getRules=function(){var _this$props3=_this.props,_this$props3$rules=_this$props3.rules,fieldContext=_this$props3.fieldContext;return(void 0===_this$props3$rules?[]:_this$props3$rules).map(function(rule){return"function"===
typeof rule?rule(fieldContext):rule})};_this.refresh=function(){_this.mounted&&_this.setState(function(_ref){return{resetCount:_ref.resetCount+1}})};_this.onStoreChange=function(prevStore,namePathList,info){var _this$props4=_this.props,shouldUpdate=_this$props4.shouldUpdate,_this$props4$dependen=_this$props4.dependencies;_this$props4$dependen=void 0===_this$props4$dependen?[]:_this$props4$dependen;_this$props4=_this$props4.onReset;var store=info.store,namePath=_this.getNamePath(),prevValue=_this.getValue(prevStore),
curValue=_this.getValue(store),namePathMatch=namePathList&&(0,_valueUtil.containsNamePath)(namePathList,namePath);"valueUpdate"===info.type&&"external"===info.source&&prevValue!==curValue&&(_this.touched=!0,_this.dirty=!0,_this.validatePromise=null,_this.errors=[]);switch(info.type){case "reset":if(!namePathList||namePathMatch){_this.touched=!1;_this.dirty=!1;_this.validatePromise=null;_this.errors=[];_this$props4&&_this$props4();_this.refresh();return}break;case "setField":if(namePathMatch){prevStore=
info.data;"touched"in prevStore&&(_this.touched=prevStore.touched);"validating"in prevStore&&!("originRCField"in prevStore)&&(_this.validatePromise=prevStore.validating?Promise.resolve([]):null);"errors"in prevStore&&(_this.errors=prevStore.errors||[]);_this.dirty=!0;_this.reRender();return}if(shouldUpdate&&!namePath.length&&requireUpdate(shouldUpdate,prevStore,store,prevValue,curValue,info)){_this.reRender();return}break;case "dependenciesUpdate":if(_this$props4$dependen.map(_valueUtil.getNamePath).some(function(dependency){return(0,
_valueUtil.containsNamePath)(info.relatedFields,dependency)})){_this.reRender();return}break;default:if(namePathMatch||(!_this$props4$dependen.length||namePath.length||shouldUpdate)&&requireUpdate(shouldUpdate,prevStore,store,prevValue,curValue,info)){_this.reRender();return}}!0===shouldUpdate&&_this.reRender()};_this.validateRules=function(options){var namePath=_this.getNamePath(),currentValue=_this.getValue(),rootPromise=Promise.resolve().then(function(){if(!_this.mounted)return[];var _this$props5=
_this.props,_this$props5$validate=_this$props5.validateFirst;_this$props5$validate=void 0===_this$props5$validate?!1:_this$props5$validate;_this$props5=_this$props5.messageVariables;var triggerName=(options||{}).triggerName,filteredRules=_this.getRules();triggerName&&(filteredRules=filteredRules.filter(function(rule){return(rule=rule.validateTrigger)?(0,_typeUtil.toArray)(rule).includes(triggerName):!0}));_this$props5$validate=(0,_validateUtil.validateRules)(namePath,currentValue,filteredRules,options,
_this$props5$validate,_this$props5);_this$props5$validate.catch(function(e){return e}).then(function(){var errors=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[];_this.validatePromise===rootPromise&&(_this.validatePromise=null,_this.errors=errors,_this.reRender())});return _this$props5$validate});_this.validatePromise=rootPromise;_this.dirty=!0;_this.errors=[];_this.reRender();return rootPromise};_this.isFieldValidating=function(){return!!_this.validatePromise};_this.isFieldTouched=function(){return _this.touched};
_this.isFieldDirty=function(){return _this.dirty};_this.getErrors=function(){return _this.errors};_this.isListField=function(){return _this.props.isListField};_this.isList=function(){return _this.props.isList};_this.isPreserve=function(){return _this.props.preserve};_this.getMeta=function(){_this.prevValidating=_this.isFieldValidating();return{touched:_this.isFieldTouched(),validating:_this.prevValidating,errors:_this.errors,name:_this.getNamePath()}};_this.getOnlyChild=function(children){if("function"===
typeof children){var meta=_this.getMeta();return(0,_objectSpread2.default)((0,_objectSpread2.default)({},_this.getOnlyChild(children(_this.getControlled(),meta,_this.props.fieldContext))),{},{isFunction:!0})}children=(0,_toArray.default)(children);return 1===children.length&&React.isValidElement(children[0])?{child:children[0],isFunction:!1}:{child:children,isFunction:!1}};_this.getValue=function(store){var getFieldsValue=_this.props.fieldContext.getFieldsValue,namePath=_this.getNamePath();return(0,
_valueUtil.getValue)(store||getFieldsValue(!0),namePath)};_this.getControlled=function(){var childProps=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},_this$props6=_this.props,trigger=_this$props6.trigger,validateTrigger=_this$props6.validateTrigger,getValueFromEvent=_this$props6.getValueFromEvent,normalize=_this$props6.normalize,valuePropName=_this$props6.valuePropName,getValueProps=_this$props6.getValueProps;_this$props6=_this$props6.fieldContext;validateTrigger=void 0!==validateTrigger?
validateTrigger:_this$props6.validateTrigger;var namePath=_this.getNamePath(),getInternalHooks=_this$props6.getInternalHooks,getFieldsValue=_this$props6.getFieldsValue,dispatch=getInternalHooks(_FieldContext.HOOK_MARK).dispatch,value=_this.getValue();getValueProps=getValueProps||function(val){return(0,_defineProperty2.default)({},valuePropName,val)};var originTriggerFunc=childProps[trigger],control=(0,_objectSpread2.default)((0,_objectSpread2.default)({},childProps),getValueProps(value));control[trigger]=
function(){_this.touched=!0;_this.dirty=!0;var newValue=arguments.length;for(var args=Array(newValue),_key=0;_key<newValue;_key++)args[_key]=arguments[_key];newValue=getValueFromEvent?getValueFromEvent.apply(void 0,args):_valueUtil.defaultGetValueFromEvent.apply(void 0,[valuePropName].concat(args));normalize&&(newValue=normalize(newValue,value,getFieldsValue(!0)));dispatch({type:"updateValue",namePath:namePath,value:newValue});originTriggerFunc&&originTriggerFunc.apply(void 0,args)};(0,_typeUtil.toArray)(validateTrigger||
[]).forEach(function(triggerName){var originTrigger=control[triggerName];control[triggerName]=function(){originTrigger&&originTrigger.apply(void 0,arguments);var rules=_this.props.rules;rules&&rules.length&&dispatch({type:"validateField",namePath:namePath,triggerName:triggerName})}});return control};props.fieldContext&&(props=props.fieldContext.getInternalHooks,props=props(_FieldContext.HOOK_MARK).initEntityValue,props((0,_assertThisInitialized2.default)(_this)));return _this}(0,_inherits2.default)(Field,
_React$Component);var _super=(0,_createSuper2.default)(Field);(0,_createClass2.default)(Field,[{key:"componentDidMount",value:function(){var _this$props7=this.props,shouldUpdate=_this$props7.shouldUpdate;_this$props7=_this$props7.fieldContext;this.mounted=!0;_this$props7&&(_this$props7=_this$props7.getInternalHooks,_this$props7=_this$props7(_FieldContext.HOOK_MARK).registerField,this.cancelRegisterFunc=_this$props7(this));!0===shouldUpdate&&this.reRender()}},{key:"componentWillUnmount",value:function(){this.cancelRegister();
this.mounted=!1}},{key:"reRender",value:function(){this.mounted&&this.forceUpdate()}},{key:"render",value:function(){var resetCount=this.state.resetCount,_this$getOnlyChild=this.getOnlyChild(this.props.children),child=_this$getOnlyChild.child;_this$getOnlyChild.isFunction?_this$getOnlyChild=child:React.isValidElement(child)?_this$getOnlyChild=React.cloneElement(child,this.getControlled(child.props)):((0,_warning.default)(!child,"`children` of Field is not validate ReactElement."),_this$getOnlyChild=
child);return React.createElement(React.Fragment,{key:resetCount},_this$getOnlyChild)}}]);return Field}(React.Component);Field.contextType=_FieldContext.default;Field.defaultProps={trigger:"onChange",valuePropName:"value"};exports.default=function(_ref4){var name=_ref4.name;_ref4=(0,_objectWithoutProperties2.default)(_ref4,["name"]);var fieldContext=React.useContext(_FieldContext.default);name=void 0!==name?(0,_valueUtil.getNamePath)(name):void 0;var key="keep";_ref4.isListField||(key="_".concat((name||
[]).join("_")));!1===_ref4.preserve&&_ref4.isListField&&1>=name.length&&(0,_warning.default)(!1,"`preserve` should not apply on Form.List fields.");return React.createElement(Field,(0,_extends2.default)({key:key,name:name},_ref4,{fieldContext:fieldContext}))}}
//# sourceMappingURL=module$node_modules$rc_field_form$lib$Field.js.map
