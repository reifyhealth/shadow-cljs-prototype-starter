shadow$provide.module$node_modules$rc_menu$lib$DOMWrap=function(global,require,module,exports){global=require("module$node_modules$$babel$runtime$helpers$interopRequireWildcard");module=require("module$node_modules$$babel$runtime$helpers$interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:!0});exports.default=void 0;var _toConsumableArray2=module(require("module$node_modules$$babel$runtime$helpers$toConsumableArray")),_extends2=module(require("module$node_modules$$babel$runtime$helpers$extends")),
_objectSpread2=module(require("module$node_modules$$babel$runtime$helpers$objectSpread2")),_objectWithoutProperties2=module(require("module$node_modules$$babel$runtime$helpers$objectWithoutProperties")),_classCallCheck2=module(require("module$node_modules$$babel$runtime$helpers$classCallCheck")),_createClass2=module(require("module$node_modules$$babel$runtime$helpers$createClass")),_inherits2=module(require("module$node_modules$$babel$runtime$helpers$inherits")),_createSuper2=module(require("module$node_modules$$babel$runtime$helpers$createSuper")),
React=global(require("module$node_modules$react$index")),_resizeObserverPolyfill=module(require("module$node_modules$resize_observer_polyfill$dist$ResizeObserver")),_SubMenu=module(require("module$node_modules$rc_menu$lib$SubMenu")),_util=require("module$node_modules$rc_menu$lib$util");require=function(_React$Component){function DOMWrap(){(0,_classCallCheck2.default)(this,DOMWrap);var _this=_super.apply(this,arguments);_this.resizeObserver=null;_this.mutationObserver=null;_this.originalTotalWidth=
0;_this.overflowedItems=[];_this.menuItemSizes=[];_this.cancelFrameId=null;_this.state={lastVisibleIndex:void 0};_this.childRef=React.createRef();_this.getMenuItemNodes=function(){var prefixCls=_this.props.prefixCls,ul=_this.childRef.current;return ul?[].slice.call(ul.children).filter(function(node){return 0>node.className.split(" ").indexOf("".concat(prefixCls,"-overflowed-submenu"))}):[]};_this.getOverflowedSubMenuItem=function(keyPrefix,overflowedItems,renderPlaceholder){var _this$props=_this.props,
overflowedIndicator=_this$props.overflowedIndicator,mode=_this$props.mode,prefixCls=_this$props.prefixCls,theme=_this$props.theme;if(1!==_this$props.level||"horizontal"!==mode)return null;_this$props=_this.props.children[0].props;mode=_this$props.style;var rest=(0,_objectWithoutProperties2.default)(_this$props,["children","title","style"]);_this$props=(0,_objectSpread2.default)({},mode);mode="".concat(keyPrefix,"-overflowed-indicator");keyPrefix="".concat(keyPrefix,"-overflowed-indicator");0===overflowedItems.length&&
!0!==renderPlaceholder?_this$props=(0,_objectSpread2.default)((0,_objectSpread2.default)({},_this$props),{},{display:"none"}):renderPlaceholder&&(_this$props=(0,_objectSpread2.default)((0,_objectSpread2.default)({},_this$props),{},{visibility:"hidden",position:"absolute"}),mode="".concat(mode,"-placeholder"),keyPrefix="".concat(keyPrefix,"-placeholder"));renderPlaceholder=theme?"".concat(prefixCls,"-").concat(theme):"";var props={};_util.menuAllProps.forEach(function(k){void 0!==rest[k]&&(props[k]=
rest[k])});return React.createElement(_SubMenu.default,(0,_extends2.default)({title:overflowedIndicator,className:"".concat(prefixCls,"-overflowed-submenu"),popupClassName:renderPlaceholder},props,{key:mode,eventKey:keyPrefix,disabled:!1,style:_this$props}),overflowedItems)};_this.setChildrenWidthAndResize=function(){if("horizontal"===_this.props.mode){var ul=_this.childRef.current;if(ul){var ulChildrenNodes=ul.children;if(ulChildrenNodes&&0!==ulChildrenNodes.length){ulChildrenNodes=ul.children[ulChildrenNodes.length-
1];(0,_util.setStyle)(ulChildrenNodes,"display","inline-block");var menuItemNodes=_this.getMenuItemNodes(),overflowedItems=menuItemNodes.filter(function(c){return 0<=c.className.split(" ").indexOf("menuitem-overflowed")});overflowedItems.forEach(function(c){(0,_util.setStyle)(c,"display","inline-block")});_this.menuItemSizes=menuItemNodes.map(function(c){return(0,_util.getWidth)(c,!0)});overflowedItems.forEach(function(c){(0,_util.setStyle)(c,"display","none")});_this.overflowedIndicatorWidth=(0,
_util.getWidth)(ul.children[ul.children.length-1],!0);_this.originalTotalWidth=_this.menuItemSizes.reduce(function(acc,cur){return acc+cur},0);_this.handleResize();(0,_util.setStyle)(ulChildrenNodes,"display","none")}}}};_this.handleResize=function(){if("horizontal"===_this.props.mode){var ul=_this.childRef.current;if(ul){var width=(0,_util.getWidth)(ul);_this.overflowedItems=[];var currentSumWidth=0;if(_this.originalTotalWidth>width+.5){var lastVisibleIndex=-1;_this.menuItemSizes.forEach(function(liWidth){currentSumWidth+=
liWidth;currentSumWidth+_this.overflowedIndicatorWidth<=width&&(lastVisibleIndex+=1)})}_this.setState({lastVisibleIndex:lastVisibleIndex})}}};return _this}(0,_inherits2.default)(DOMWrap,_React$Component);var _super=(0,_createSuper2.default)(DOMWrap);(0,_createClass2.default)(DOMWrap,[{key:"componentDidMount",value:function(){var _this2=this;this.setChildrenWidthAndResize();if(1===this.props.level&&"horizontal"===this.props.mode){var menuUl=this.childRef.current;menuUl&&(this.resizeObserver=new _resizeObserverPolyfill.default(function(entries){entries.forEach(function(){cancelAnimationFrame(_this2.cancelFrameId);
_this2.cancelFrameId=requestAnimationFrame(_this2.setChildrenWidthAndResize)})}),[].slice.call(menuUl.children).concat(menuUl).forEach(function(el){_this2.resizeObserver.observe(el)}),"undefined"!==typeof MutationObserver&&(this.mutationObserver=new MutationObserver(function(){_this2.resizeObserver.disconnect();[].slice.call(menuUl.children).concat(menuUl).forEach(function(el){_this2.resizeObserver.observe(el)});_this2.setChildrenWidthAndResize()}),this.mutationObserver.observe(menuUl,{attributes:!1,
childList:!0,subTree:!1})))}}},{key:"componentWillUnmount",value:function(){this.resizeObserver&&this.resizeObserver.disconnect();this.mutationObserver&&this.mutationObserver.disconnect();cancelAnimationFrame(this.cancelFrameId)}},{key:"renderChildren",value:function(children){var _this3=this,lastVisibleIndex=this.state.lastVisibleIndex;return(children||[]).reduce(function(acc,childNode,index){var item=childNode;if("horizontal"===_this3.props.mode){var overflowed=_this3.getOverflowedSubMenuItem(childNode.props.eventKey,
[]);void 0!==lastVisibleIndex&&-1!==_this3.props.className.indexOf("".concat(_this3.props.prefixCls,"-root"))&&(index>lastVisibleIndex&&(item=React.cloneElement(childNode,{style:{display:"none"},eventKey:"".concat(childNode.props.eventKey,"-hidden"),className:"".concat("menuitem-overflowed")})),index===lastVisibleIndex+1&&(_this3.overflowedItems=children.slice(lastVisibleIndex+1).map(function(c){return React.cloneElement(c,{key:c.props.eventKey,mode:"vertical-left"})}),overflowed=_this3.getOverflowedSubMenuItem(childNode.props.eventKey,
_this3.overflowedItems)));acc=[].concat((0,_toConsumableArray2.default)(acc),[overflowed,item]);index===children.length-1&&acc.push(_this3.getOverflowedSubMenuItem(childNode.props.eventKey,[],!0));return acc}return[].concat((0,_toConsumableArray2.default)(acc),[item])},[])}},{key:"render",value:function(){var _this$props2=this.props,tag=_this$props2.tag,children=_this$props2.children;_this$props2=(0,_objectWithoutProperties2.default)(_this$props2,"visible prefixCls overflowedIndicator mode level tag children theme".split(" "));
return React.createElement(tag,(0,_extends2.default)({ref:this.childRef},_this$props2),this.renderChildren(children))}}]);return DOMWrap}(React.Component);require.defaultProps={tag:"div",className:""};exports.default=require}
//# sourceMappingURL=module$node_modules$rc_menu$lib$DOMWrap.js.map
